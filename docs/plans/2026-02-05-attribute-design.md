# 无极 - 属性系统设计

## 设计概述

基于五行世界观，设计25个属性技能，每种五行掌管5个属性。属性与五行强关联，选择某种五行装备就意味着选择某类属性方向。

### 核心机制

```
装备品质(白/绿/蓝/紫/橙) → 提供五行属性等级(1-5)
        ↓
多件同五行装备叠加 → 玩家五行总等级(最高10)
        ↓
装备自带技能 → 按玩家五行总等级生效(1-10级数值)
        ↓
装备强化等级(+0~+4) → 决定技能数量(1-5个)
```

### 五行相生与属性关联

每种五行的第5个属性"藏"有其所生五行的特性：

```
金 ─生→ 水 ─生→ 木 ─生→ 火 ─生→ 土 ─生→ 金
│       │       │       │       │
藏水    藏木    藏火    藏土    藏金
寒锋    润泽    怒木    余烬    蓄势
```

---

## 装备系统

### 品质等级

| 品质 | 等级 | 提供五行属性等级 | 获取方式 |
|------|------|------------------|----------|
| 白色 | 1 | +1级 | 掉落 |
| 绿色 | 2 | +2级 | 掉落 |
| 蓝色 | 3 | +3级 | 掉落 |
| 紫色 | 4 | +4级 | 掉落 |
| 橙色 | 5 | +5级 | 仅合成 |

### 掉落规则（6回合制）

| 回合 | 基础品质 | 普通怪最高品质 | 精英怪最高品质(+1) |
|------|----------|----------------|-------------------|
| 1 | 0 | 白色 | 绿色 |
| 2 | 0 | 白色 | 绿色 |
| 3 | 1 | 绿色 | 蓝色 |
| 4 | 1 | 绿色 | 蓝色 |
| 5 | 2 | 蓝色 | 紫色 |
| 6 | 2 | 蓝色 | 紫色 |

**注意**：表中为"最高"品质，实际掉落在该范围内随机。第6回合普通怪也可能掉落白色/绿色/蓝色。

### 强化等级与技能数量

| 强化等级 | 技能数量 |
|----------|----------|
| +0 | 1个技能 |
| +1 | 2个技能 |
| +2 | 3个技能 |
| +3 | 4个技能 |
| +4 | 5个技能 |

技能从装备对应五行的5个技能中随机选取。

---

## 五行属性详解

### 金属性（锐利肃杀）

金主肃杀，代表锐利、破坏、致命一击。金属性装备让残魂成为高爆发的猎杀者。

| 属性名 | 效果 | 设计说明 |
|--------|------|----------|
| **锐度** | 暴击率，暴击造成150%伤害 | 核心输出属性 |
| **锋芒** | 暴击伤害加成（150%→更高） | 配合锐度叠加爆发 |
| **破甲** | 无视目标X%防御 | 对抗高防敌人 |
| **杀意** | 对生命值低于30%的目标，伤害+X | 收割残血 |
| **寒锋** | 暴击时X%概率使目标减速1回合 | 金中藏水 |

**战斗风格**：高风险高回报，追求快速击杀。

#### 金属性数值表

| 等级 | 锐度(暴击率) | 锋芒(暴击伤害) | 破甲(无视防御) | 杀意(斩杀加伤) | 寒锋(暴击减速率) |
|------|-------------|---------------|---------------|---------------|-----------------|
| 1 | 5% | +10% | 5% | +3 | 10% |
| 2 | 8% | +15% | 8% | +5 | 15% |
| 3 | 11% | +20% | 11% | +8 | 20% |
| 4 | 14% | +25% | 14% | +11 | 25% |
| 5 | 17% | +30% | 17% | +15 | 30% |
| 6 | 20% | +36% | 20% | +19 | 36% |
| 7 | 23% | +42% | 23% | +24 | 42% |
| 8 | 26% | +48% | 26% | +29 | 48% |
| 9 | 29% | +55% | 29% | +35 | 55% |
| 10 | 33% | +65% | 33% | +42 | 65% |

---

### 水属性（灵动玄妙）

水主灵动，代表闪避、精准、控制。水属性装备让残魂如水般难以捉摸。

| 属性名 | 效果 | 设计说明 |
|--------|------|----------|
| **灵动** | 闪避率，闪避时完全规避伤害 | 核心生存属性 |
| **洞察** | 命中率，降低目标闪避效果 | 对抗高闪敌人 |
| **凝滞** | 攻击时X%概率使目标减速 | 控制能力 |
| **玄冰** | 减速状态的敌人受到伤害+X% | 控制后追加伤害 |
| **润泽** | 闪避成功时回复X%最大生命 | 水中藏木 |

**战斗风格**：以柔克刚，通过闪避和控制拖延战斗。

#### 水属性数值表

| 等级 | 灵动(闪避率) | 洞察(命中率) | 凝滞(减速率) | 玄冰(控制加伤) | 润泽(闪避回血) |
|------|-------------|-------------|-------------|---------------|---------------|
| 1 | 4% | 5% | 8% | +5% | 2% |
| 2 | 6% | 8% | 12% | +8% | 3% |
| 3 | 8% | 11% | 16% | +11% | 4% |
| 4 | 10% | 14% | 20% | +14% | 5% |
| 5 | 12% | 17% | 24% | +17% | 6% |
| 6 | 14% | 20% | 28% | +21% | 7% |
| 7 | 16% | 23% | 32% | +25% | 8% |
| 8 | 18% | 26% | 36% | +29% | 9% |
| 9 | 21% | 29% | 41% | +34% | 10% |
| 10 | 25% | 33% | 48% | +40% | 12% |

---

### 木属性（生生不息）

木主生长，代表生命、回复、顽强。木属性装备让残魂拥有惊人的续航能力。

| 属性名 | 效果 | 设计说明 |
|--------|------|----------|
| **根基** | 最大生命值+X | 核心生存属性 |
| **生机** | 每回合回复X%最大生命 | 持续续航 |
| **韧性** | 生命低于30%时，受到伤害减少X% | 低血量时更难被击杀 |
| **逢春** | 受到致命伤害时，X%概率保留1点生命（每场限1次） | 绝境求生 |
| **怒木** | 生命低于50%时，攻击力+X% | 木中藏火 |

**战斗风格**：打不死的小强，以持久战为核心。

#### 木属性数值表

| 等级 | 根基(最大生命) | 生机(每回合回复) | 韧性(低血减伤) | 逢春(致命保护率) | 怒木(低血加攻) |
|------|---------------|-----------------|---------------|-----------------|---------------|
| 1 | +20 | 2% | 5% | 5% | +5% |
| 2 | +35 | 3% | 8% | 8% | +8% |
| 3 | +50 | 4% | 11% | 11% | +11% |
| 4 | +70 | 5% | 14% | 14% | +14% |
| 5 | +90 | 6% | 17% | 17% | +18% |
| 6 | +115 | 7% | 20% | 21% | +22% |
| 7 | +140 | 8% | 23% | 25% | +26% |
| 8 | +170 | 9% | 26% | 29% | +30% |
| 9 | +200 | 10% | 30% | 34% | +35% |
| 10 | +240 | 12% | 35% | 40% | +42% |

---

### 火属性（炽烈爆发）

火主炽烈，代表攻击、燃烧、狂暴。火属性装备让残魂化身进攻的烈焰。

| 属性名 | 效果 | 设计说明 |
|--------|------|----------|
| **炎威** | 攻击力+X% | 核心输出属性 |
| **燎原** | 攻击时X%概率施加灼烧 | 持续灼烧伤害 |
| **暴燃** | 对灼烧状态的敌人伤害+X% | 火上浇油 |
| **焚意** | 生命越低，攻击力越高（最高+X%） | 背水一战 |
| **余烬** | 受到伤害时，X%概率使攻击者灼烧 | 火中藏土 |

**战斗风格**：纯粹的进攻，追求最大化伤害输出。

#### 火属性数值表

| 等级 | 炎威(攻击力%) | 燎原(灼烧率) | 暴燃(灼烧加伤) | 焚意(残血狂暴) | 余烬(受击灼敌率) |
|------|-------------|-------------|---------------|---------------|-----------------|
| 1 | +5% | 10% | +5% | +8% | 8% |
| 2 | +8% | 14% | +8% | +12% | 11% |
| 3 | +11% | 18% | +11% | +16% | 14% |
| 4 | +14% | 22% | +14% | +20% | 17% |
| 5 | +17% | 26% | +17% | +25% | 20% |
| 6 | +20% | 30% | +21% | +30% | 24% |
| 7 | +24% | 34% | +25% | +36% | 28% |
| 8 | +28% | 38% | +29% | +42% | 32% |
| 9 | +32% | 43% | +34% | +50% | 37% |
| 10 | +38% | 50% | +40% | +60% | 44% |

---

### 土属性（厚重不动）

土主厚重，代表防御、格挡、反击。土属性装备让残魂成为坚不可摧的堡垒。

| 属性名 | 效果 | 设计说明 |
|--------|------|----------|
| **坚壁** | 防御力+X% | 核心防御属性 |
| **磐石** | 格挡率，格挡时伤害减少50% | 稳定减伤 |
| **厚土** | 所有受到的伤害-X%（固定减伤） | 对抗高频攻击 |
| **反震** | 受到伤害时，将X%伤害反弹给攻击者 | 被动反击 |
| **蓄势** | 连续受到攻击时，下次攻击伤害+X%（最多叠3层） | 土中藏金 |

**战斗风格**：以守为攻，越打它反击越狠。

#### 土属性数值表

| 等级 | 坚壁(防御力%) | 磐石(格挡率) | 厚土(固定减伤) | 反震(反伤%) | 蓄势(蓄力加伤) |
|------|-------------|-------------|---------------|------------|---------------|
| 1 | +5% | 5% | 3% | 5% | +8% |
| 2 | +8% | 7% | 5% | 7% | +12% |
| 3 | +11% | 9% | 7% | 9% | +16% |
| 4 | +14% | 11% | 9% | 11% | +20% |
| 5 | +17% | 13% | 11% | 13% | +25% |
| 6 | +20% | 15% | 13% | 16% | +30% |
| 7 | +24% | 17% | 15% | 19% | +36% |
| 8 | +28% | 19% | 17% | 22% | +42% |
| 9 | +32% | 22% | 19% | 26% | +50% |
| 10 | +38% | 25% | 22% | 30% | +60% |

---

## 属性汇总表

| 五行 | 属性1 | 属性2 | 属性3 | 属性4 | 属性5（藏子行） |
|------|-------|-------|-------|-------|-----------------|
| **金** | 锐度(暴击率) | 锋芒(暴击伤害) | 破甲(无视防御) | 杀意(斩杀加成) | 寒锋(暴击减速) |
| **水** | 灵动(闪避) | 洞察(命中) | 凝滞(减速率) | 玄冰(控制加伤) | 润泽(闪避回血) |
| **木** | 根基(最大生命) | 生机(回复) | 韧性(低血减伤) | 逢春(致命保护) | 怒木(低血加攻) |
| **火** | 炎威(攻击%) | 燎原(灼烧率) | 暴燃(灼烧加伤) | 焚意(残血狂暴) | 余烬(受击灼敌) |
| **土** | 坚壁(防御%) | 磐石(格挡) | 厚土(固定减伤) | 反震(反伤) | 蓄势(蓄力爆发) |

---

## 设计说明

### 属性叠加示例

**场景**：玩家装备金属性武器(蓝色+2)、金属性铠甲(绿色+1)、火属性灵器(白色+0)

- 金属性总等级：3(蓝色) + 2(绿色) = 5级
- 火属性总等级：1(白色) = 1级

**武器技能**（+2，3个技能）：
- 锐度 → 按5级生效：17%暴击率
- 破甲 → 按5级生效：17%无视防御
- 寒锋 → 按5级生效：30%暴击减速率

**铠甲技能**（+1，2个技能）：
- 锋芒 → 按5级生效：+30%暴击伤害
- 杀意 → 按5级生效：+15斩杀伤害

**灵器技能**（+0，1个技能）：
- 燎原 → 按1级生效：10%灼烧率

### 构建思路

- **纯金流**：追求暴击爆发，一击致命
- **纯木流**：超强续航，拖死对手
- **纯土流**：铁壁反击，以守为攻
- **金水混搭**：暴击+闪避，刺客风格
- **火土混搭**：灼烧+反伤，持续消耗
- **木火混搭**：低血触发怒木+焚意，绝地反击

---

## 实现细节

### 重复技能规则

当多件装备拥有相同技能时，该技能等级+1（每重复一次+1），但上限为10级。

**示例**：
```
玩家金五行等级 = 5
武器技能：锐度、破甲
铠甲技能：锐度、杀意

→ 锐度：5+1 = 6级生效（重复+1）
→ 破甲：5级生效
→ 杀意：5级生效
```

**设计意图**：
- 低五行等级时，重复技能有收益
- 高五行等级时（接近10级），鼓励追求技能多样性

### 强化机制

- 装备生成时随机选择1个对应五行的技能
- 每次强化从剩余4个技能中随机选择1个新增
- 强化不会改变已有技能

### 五行圆满（保留）

**触发条件**：5件法宝各为不同五行属性

**效果**：
- 每回合恢复5%最大生命值
- 免疫所有负面状态（灼烧、减速等）

---

## 代码实现计划

### 删除内容

| 文件 | 删除内容 |
|------|----------|
| `types/Wuxing.ts` | `WUXING_PASSIVE_CONFIG` 及相关类型 |
| `types/Equipment.ts` | `Skill` 接口、`skill` 字段 |
| `logic/SkillProcessor.ts` | 整个文件（或重构） |
| `data/EquipmentDatabase.ts` | 所有装备的 `skill` 字段 |
| `logic/WuxingPassiveProcessor.ts` | 旧五行被动逻辑（保留五行圆满） |

### 新增内容

| 文件 | 内容 |
|------|------|
| `data/AttributeSkillDatabase.ts` | 25个技能定义 + 10级数值表 |
| `logic/AttributeSkillProcessor.ts` | 技能效果处理器 |
| `types/Equipment.ts` | `attributeSkills: AttributeSkillId[]` 字段 |

### 修改内容

| 文件 | 修改内容 |
|------|----------|
| `logic/BattleEngine.ts` | 接入新技能处理 |
| `logic/DamageCalculator.ts` | 使用新属性计算伤害 |
| `logic/BattleTypes.ts` | 新增战斗属性字段 |

### 实现顺序

1. 新建 `AttributeSkillDatabase.ts`，定义25个技能和数值表
2. 新建 `AttributeSkillProcessor.ts`，实现技能效果处理
3. 修改 `Equipment.ts`，替换技能字段
4. 修改装备生成/强化逻辑
5. 修改战斗系统接入新技能
6. 清理旧代码
7. 测试验证
